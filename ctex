#!/bin/zsh

texFiles=(`ls *.tex`)
for texFile in $texFiles
do
    mainTex=`grep \\documentclass $texFile`
    if [ -n "$mainTex" ]
    then
        break
    fi
done

if [ -z "$mainTex" ]
then
    exit
fi

platex $texFile:r.tex > tex.log 2>&1
exitStatus=$?
dvipdfmx $texFile:r.dvi >> tex.log 2>&1

if [ $exitStatus -eq 0 ]
then
    open $texFile:r.pdf
else
    cat tex.log
fi
